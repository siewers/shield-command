<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:ShieldCommander.UI.ViewModels"
        xmlns:ui="using:FluentAvalonia.UI.Controls"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
        x:Class="ShieldCommander.UI.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding WindowTitle}"
        Width="900" Height="600"
        MinWidth="700" MinHeight="450"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="PreferSystemChrome"
        ExtendClientAreaTitleBarHeightHint="38">

    <NativeMenu.Menu>
        <NativeMenu>
            <NativeMenuItem Header="View">
                <NativeMenu>
                    <NativeMenuItem Header="Update Frequency">
                        <NativeMenu>
                            <NativeMenuItem Header="Very often (1 sec)" ToggleType="CheckBox"
                                            Click="UpdateFrequency_Click" />
                            <NativeMenuItem Header="Often (2 sec)" ToggleType="CheckBox" Click="UpdateFrequency_Click" />
                            <NativeMenuItem Header="Normally (5 sec)" ToggleType="CheckBox" IsChecked="True"
                                            Click="UpdateFrequency_Click" />
                        </NativeMenu>
                    </NativeMenuItem>
                </NativeMenu>
            </NativeMenuItem>
        </NativeMenu>
    </NativeMenu.Menu>

    <Design.DataContext>
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="38,*">
        <!-- Title bar overlay -->
        <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto">
            <!-- Col 0: spacer for macOS traffic lights (shrinks to 0 on Windows via code-behind) -->
            <Border x:Name="TitleBarLeftSpacer" Grid.Column="0" Width="78" />
            <!-- Col 1: drag region â€” on Windows also shows app icon + title -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8"
                        VerticalAlignment="Center" Margin="8,0,0,0"
                        x:Name="TitleBarAppInfo" IsVisible="False"
                        IsHitTestVisible="False">
                <Image Source="/Assets/app-icon.png" Width="16" Height="16"
                       VerticalAlignment="Center" />
                <TextBlock Text="Shield Commander" FontSize="12"
                           VerticalAlignment="Center" />
            </StackPanel>
            <!-- Col 2: clickable status -->
            <Button Grid.Column="2"
                    x:Name="TitleBarStatusButton"
                    Click="TitleBarStatusButton_Click"
                    Background="#01000000"
                    BorderThickness="0"
                    Padding="12,6,16,6"
                    VerticalAlignment="Stretch"
                    Cursor="Hand">
                <StackPanel Orientation="Horizontal" Spacing="6"
                            VerticalAlignment="Center">
                    <Ellipse x:Name="ConnectionIndicator"
                             Width="8" Height="8"
                             Fill="#FF4444"
                             Margin="2"
                             VerticalAlignment="Center" />
                    <TextBlock Text="{Binding ConnectionStatusText}"
                               FontSize="12" />
                </StackPanel>
            </Button>
        </Grid>

        <!-- Main content -->
        <ui:NavigationView Grid.Row="1"
                           x:Name="NavView"
                           PaneDisplayMode="Left"
                           OpenPaneLength="200"
                           IsBackButtonVisible="False"
                           IsPaneToggleButtonVisible="True"
                           IsSettingsVisible="False"
                           PaneTitle="Shield Commander"
                           SelectionChanged="NavView_SelectionChanged"
                           ItemInvoked="NavView_ItemInvoked">
            <ui:NavigationView.Resources>
                <x:Double x:Key="NavigationViewItemOnLeftIconBoxHeight">20</x:Double>
            </ui:NavigationView.Resources>
            <ui:NavigationView.Content>
                <ContentControl Content="{Binding CurrentPage}" Margin="24,16" />
            </ui:NavigationView.Content>
            <ui:NavigationView.MenuItems>
                <ui:NavigationViewItem Content="System Info" Tag="SystemInfo"
                                       IsEnabled="{Binding IsDeviceConnected}" />
                <ui:NavigationViewItem Content="Apps" Tag="Apps"
                                       IsEnabled="{Binding IsDeviceConnected}" />
                <ui:NavigationViewItem Content="Activity Monitor" Tag="CPU"
                                       IsEnabled="{Binding IsDeviceConnected}"
                                       IsExpanded="True" SelectsOnInvoked="True">
                    <ui:NavigationViewItem.MenuItems>
                        <ui:NavigationViewItem Content="CPU" Tag="CPU" />
                        <ui:NavigationViewItem Content="Memory" Tag="Memory" />
                        <ui:NavigationViewItem Content="Disk I/O" Tag="Disk" />
                        <ui:NavigationViewItem Content="Network" Tag="Network" />
                        <ui:NavigationViewItem Content="Thermals" Tag="Thermals" />
                        <ui:NavigationViewItem Content="Processes" Tag="Processes" />
                    </ui:NavigationViewItem.MenuItems>
                </ui:NavigationViewItem>
            </ui:NavigationView.MenuItems>
            <ui:NavigationView.FooterMenuItems>
                <ui:NavigationViewItem Content="Settings" Tag="Settings" SelectsOnInvoked="False"
                                       x:Name="SettingsNavItem" />
                <ui:NavigationViewItem Content="About" Tag="About" SelectsOnInvoked="False" />
            </ui:NavigationView.FooterMenuItems>
        </ui:NavigationView>
    </Grid>
</Window>
